#include "appTypes.h"
#include "drvC8051F02xCore.h"

/**********************************************************************************/
/***                    常量定义                                                      */
/**********************************************************************************/


/**********************************************************************************/
/***                    局部函数声明                                                    */
/**********************************************************************************/
LOCAL void CoreOscillatorInit(void);
LOCAL void CoreRstSrcInit(void);
LOCAL void CoreGpioInit(void);

/**********************************************************************************/
/***                    C8051内核初始化                                                */
/**********************************************************************************/
void CoreInit(void)
{
    CoreRstSrcInit();
    CoreOscillatorInit();
    CoreGpioInit();
}

/*********************************************************************************/
/***                    C8051复位初始化                                               */
/*********************************************************************************/
void CoreRstSrcInit(void)
{
    WDTCN = 0xDE;
    WDTCN = 0xAD;
    RSTSRC = 0x04;
}

/********************************************************************************/
/***                    C8051晶振初始化                                              */
/********************************************************************************/
void CoreOscillatorInit(void)
{
    int i = 0;
    OSCXCN = 0x67;
    for(i = 0; i < 3000; i++);      //wait 1ms for initalization
    while((OSCXCN & 0x80) == 0);
    OSCICN = 0x08;
}

/******************************************************************************/
/***                    C8051IO端口初始化                                          */
void CoreGpioInit(void)
{
    P0MDOUT = 0xFC;
    P1MDOUT = 0xFF;
    P2MDOUT = 0xFF;
    P3MDOUT = 0xFF;
    XBR0    = 0x04;
    XBR1    = 0x40;
}
